BootStrap: docker
From: rockylinux:8

%post
    # basic devel + system packages:
    dnf -y install dnf-plugins-core sudo wget curl
    dnf -y group install "Development Tools"
    dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
    dnf -y config-manager --set-enabled powertools
    dnf -y install git vim

    # crpropa-specific
    dnf -y install python3 python36-devel swig fftw fftw-devel libomp libomp-devel cmake python3-numpy doxygen pkgconf-pkg-config hdf5-devel hdf5 gperftools-devel gperftools zlib-devel

    #create builddir:

    BUILD_DIR=`mktemp --directory -p /tmp`
    echo "BUILD_DIR: ${BUILD_DIR}"
    
    function cleanup {      
      rm -rf "$BUILD_DIR"
      echo "Deleted temp working directory $WORK_DIR"
    }

    trap cleanup EXIT

    # *muparser

    cd $BUILD_DIR
    wget https://github.com/beltoforion/muparser/archive/refs/tags/v2.3.2.tar.gz
    tar -xvf ./v2.3.2.tar.gz
    cd muparser-2.3.2
    cmake . -DENABLE_SAMPLES=OFF -DENABLE_OPENMP=ON -DBUILD_SHARED_LIBS=ON
    make install

    # * crpropa

    cd $BUILD_DIR
    wget https://github.com/CRPropa/CRPropa3/archive/refs/tags/3.1.7.tar.gz
    tar -xvf ./3.1.7.tar.gz
    cd CRPropa3-3.1.7
    mkdir build
    cd build
    cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
    make install
    

    

    
%environment
    export LC_ALL=C
    export SHELL=/bin/bash
    #xport PATH=$PATH:/opt/node-v12.18.3-linux-x64/bin:/$HOME/.local/bin

%labels
    Author J. Dvoracek

